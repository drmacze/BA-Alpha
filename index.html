<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bloodline: Ashaterra</title>

  <!-- Font + Firebase -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;700&display=swap" rel="stylesheet" />
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

  <style>
    * {
      margin: 0; padding: 0; box-sizing: border-box;
      font-family: 'Roboto Slab', serif;
    }

    body, html {
      height: 100%;
      background-color: #0c0f12;
      overflow: hidden;
      color: #f8f8f8;
    }

    .screen {
      display: none;
      height: 100vh;
      width: 100vw;
      position: absolute;
      top: 0; left: 0;
      padding: 20px;
      background: #0c0f12;
    }

    .screen.active {
      display: block;
    }

    .bg-image {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      filter: brightness(0.3) blur(2px);
      z-index: -1;
    }

    .logo {
      font-size: 2.8rem;
      text-align: center;
      color: #fdf5c0;
      margin-top: 30vh;
      text-shadow: 0 0 10px #c89d47;
      animation: fadeIn 2s ease-in-out forwards;
    }

    .loading-bar {
      width: 60%;
      height: 8px;
      margin: 30px auto;
      border-radius: 6px;
      background-color: #c89d4777;
      overflow: hidden;
    }

    .progress {
      width: 0%;
      height: 100%;
      background: linear-gradient(to right, #c89d47, #fdf5c0);
      animation: loading 3s forwards;
    }

    @keyframes loading {
      to { width: 100%; }
    }

    @keyframes fadeIn {
      0% { opacity: 0; transform: scale(0.95); }
      100% { opacity: 1; transform: scale(1); }
    }

    form {
      max-width: 350px;
      margin: 20px auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    input {
      padding: 12px;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
    }

    button {
      padding: 12px;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-primary {
      background-color: #c89d47;
      color: #1a1a1a;
    }

    .btn-primary:hover {
      background-color: #fdf5c0;
    }

    .btn-secondary {
      background: none;
      border: 2px solid #c89d47;
      color: #c89d47;
    }

    .btn-secondary:hover {
      background-color: #c89d47;
      color: #1a1a1a;
    }

    .link {
      color: #fdf5c0;
      cursor: pointer;
      font-size: 0.9rem;
      text-align: right;
    }

    .message {
      text-align: center;
      font-weight: bold;
      color: #ff6f61;
      min-height: 24px;
    }

    .section-title {
      font-size: 1.5rem;
      margin: 20px 0 10px;
      text-align: center;
      color: #fdf5c0;
    }
  </style>
</head>

<body>

<div id="splash-screen" class="screen active">
  <img src="assets/bg-ashaterra.jpg" alt="Splash Background" class="bg-image" />
  <div class="logo">Bloodline: Ashaterra</div>
  <div class="loading-bar"><div class="progress"></div></div>
</div>

<div id="login-screen" class="screen">
  <div class="section-title">Login to Ashaterra</div>

  <form id="login-form">
    <input type="email" id="email" placeholder="Email" required />
    <input type="password" id="password" placeholder="Password" required />
    <div class="link" onclick="resetPassword()">Forgot Password?</div>
    <button type="submit" class="btn-primary">Login</button>
    <button type="button" class="btn-secondary" onclick="showRegister()">Register</button>
    <button type="button" class="btn-secondary" onclick="googleLogin()">Login with Google</button>
    <button type="button" class="btn-secondary" onclick="guestLogin()">Play as Guest</button>
  </form>

  <div class="message" id="message"></div>
</div>

<script>
  // Splash screen transition
  setTimeout(() => {
    document.getElementById("splash-screen").classList.remove("active");
    document.getElementById("login-screen").classList.add("active");
  }, 3500);

  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyAstsRmnykZJlueSMdJMPYEs1l-udFWWT0",
    authDomain: "bloodline-ashaterra.firebaseapp.com",
    projectId: "bloodline-ashaterra",
    storageBucket: "bloodline-ashaterra.firebasestorage.app",
    messagingSenderId: "925417667104",
    appId: "1:925417667104:web:e2ccafa1629333ef789a45",
    measurementId: "G-E8JV3WYFXV"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  const msg = document.getElementById("message");

  // Login
  document.getElementById("login-form").addEventListener("submit", e => {
    e.preventDefault();
    const email = emailInput.value;
    const password = passwordInput.value;

    auth.signInWithEmailAndPassword(email, password)
      .then(() => {
        msg.innerText = "Login successful!";
        // TODO: redirect to game.html
      })
      .catch(err => {
        msg.innerText = err.message;
      });
  });

  // Google login
  function googleLogin() {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider)
      .then(() => msg.innerText = "Google login success!")
      .catch(err => msg.innerText = err.message);
  }

  // Guest login
  function guestLogin() {
    auth.signInAnonymously()
      .then(() => msg.innerText = "Guest login success!")
      .catch(err => msg.innerText = err.message);
  }

  // Reset password
  function resetPassword() {
    const email = document.getElementById("email").value;
    if (!email) {
      msg.innerText = "Enter your email first.";
      return;
    }

    auth.sendPasswordResetEmail(email)
      .then(() => msg.innerText = "Reset link sent to your email.")
      .catch(err => msg.innerText = err.message);
  }

  // Register
  function showRegister() {
    const email = prompt("Enter your email:");
    const pass = prompt("Enter your password (min 6 chars):");
    if (email && pass) {
      auth.createUserWithEmailAndPassword(email, pass)
        .then(() => msg.innerText = "Account registered!")
        .catch(err => msg.innerText = err.message);
    }
  }

  const emailInput = document.getElementById("email");
  const passwordInput = document.getElementById("password");

  // Auto login check
  auth.onAuthStateChanged(user => {
    if (user) {
      console.log("Logged in:", user.uid);
    }
  });
</script>

</body>
</html>